---
title: "Restaurant Consumer Data R Notebook"
output: html_notebook
---
```{r}
# Curso Sistemas Inteligentes.
####### Integrantes ##########
# Anna Karen Casillas Garcia
# Josue Emmanuel Gomez 
# Luis Gonzalez

#Se requiere del enlace Descargar el archivo RCData.zip y utilizar los siguientes archivos: rating_final.csv, geoplaces2.csv, chefmozcuisine.csv https://archive.ics.uci.edu/ml/datasets/Restaurant+%26+consumer+data
```


```{r}
#Cargamos el primer set de datos
rating <- read.delim("RCdata/rating_final.csv", sep = ",", stringsAsFactors = TRUE, header=TRUE)
str(rating)
head(rating)
```


```{r}
#Para este set de datos utilizaremos solo userID, placeID y rating, creando un subset
rating <- subset(rating, select= -c(4,5))
str(rating)
head(rating)
```


```{r}
#Cargamos Geoplaces
geoplaces <- read.delim("RCdata/geoplaces2.csv", sep = ",", stringsAsFactors = TRUE, header=TRUE)
str(geoplaces)
head(geoplaces)
```


```{r}
#Para este set de datos utilizaremos solo placeID, name, city, latitude y longitude, creando un subset
geoplaces <- subset(geoplaces, select= c(1,5,7,2,3))
str(geoplaces)
head(geoplaces)
```

```{r}
#Ahora Cargamos chefmozcuisine, unicamente contiene placeID y RCuisine, que son los datos que utilizaremos por lo que no eliminaremos ninguna columna
chfcn <- read.delim("RCdata/chefmozcuisine.csv", sep = ",", stringsAsFactors = TRUE, header=TRUE)
str(chfcn)
head(chfcn)
```
## 1) De los archivos anteriores generar un solo data frame que contenga todas las variables indicadas al inicio.

```{r}
#Combinaremos los data sets para generar solo un data set
combined_data <- merge(rating,geoplaces, by="placeID") # combinamos primero rating y geoplaces
str(combined_data)
head(combined_data)
```


```{r}
#por ultimo del resultado obtenido lo combinamos con chefmozcuisine
combined_data <- merge(combined_data,chfcn, by="placeID") 
str(combined_data)
head(combined_data)
combined_data[1:6,]
```
## 2) Realizar una análisis descriptivo de las variables e indica si existen datos perdidos en algunas de ellas. De ser así, realiza un análisis para determinar y justificar la decisión que tomes sobre dichos datos perdidos. Para el caso de los datos perdidos de la variable city, puedes investigar al menos los paquetes “revgeo” o “ggmap” de R, para recuperar el nombre de la ciudad con la latitud y longitud.

```{r}
comds <- combined_data
str(comds)
```
* placeID y userID son variables de identificación, por lo tanto únicas así que ambas son categoricas
* Nombre y Ciudad son así mismo variables categoricas, únicas
* Rating es una variable númerica
* latitude y longitude, aunque n´´úmericas son parte de una dirección
** En nuestra opinión las más útiles son rating y tipo de cocina (Rcuisine), siendo raiting númerica y Rcuisine categorica **


```{r}
sum(is.na(comds))
```
### No se muestran "NA" en el set de datos

#### Veamos la distribución de opiniones

```{r}
hist(comds$rating, col = 'skyblue3', breaks = 3)
```

## 3) ¿De qué ciudades son los restaurantes del estudio?
#### Ciudades
```{r}
levels( comds$city )
```

```{r}
barplot(prop.table(table(comds$city)), col = 'skyblue3')
```
```{r}
sum(comds$city=="?")
```
### A pesar de no tener NAs tenemos 89 ciudades desconocidas

# TBD: Para el caso de los datos perdidos de la variable city, puedes investigar al menos los paquetes “revgeo” o “ggmap” de R, para recuperar el nombre de la ciudad con la latitud y longitud.


## 4) Si consideramos la popularidad de un lugar como aquellos que tienen la mayor cantidad de evaluaciones por parte de los usiarios (independientemente de si fue positiva o negativa la evaluación), obtener los nombres de los 10 restaurantes más evaluados/populares. ¿Cuántos restaurantes difernetes hay en total?

```{r}
tapply(comds$rating, comds$name , summary)
```


## 5) ¿De qué tipo de comida/cocina son los 10 restaurantes más populares encontrados en el inciso anterior? ¿Cuántos tipos de cocina diferentes hay en total?


## 6) Generar la matriz de Utilidad considerando los renglones con la variable userID, las columnas con placeID, y los valores de la matriz con rating. A partir de dicha matriz de utilidad aplicar la factorización SVD (Singular Value Decomposition) para obtener la matriz de variables latentes para los restaurantes.

```{r}
library(Matrix)
#Matriz de utilidad/Tabla de Contingencias:    
UtMx <- with(combined_data, 
             tapply(rating, list(userID,placeID), 
            sum, default=NA) )

dim(UtMx)  # dimension de UtMx
#UtMx
UtMx[is.na(UtMx)] <- 0
nombres <-colnames(UtMx)
UtMx[1:6,1:6]
```

## 7) Si a un usuario le gustó el restaurante “Gorditas Doña Gloria” con placeID: 132834, ¿Qué otros 12 restaurantes (indicar los nombres) le podrías recomendar usando la descomposición SVD con el método de correlación de “pearson” y considerando los 10 valores singulares más grandes de la SVD? Nota: no importa por el momento de qué ciudad sea el restaurante.
```{r}
#aplicamos el SVD a la traspuesta:
library(irlba)
Msvd <- svd( t(UtMx) )  # estamos tomando la traspuesta para que las movies queden en los renglones:
str(Msvd)  # para ver la estructura de las tres matrices: U*D*V
           # Observa que la matriz diagonal "d" esta dada solo como un vector unidimensional.
```
